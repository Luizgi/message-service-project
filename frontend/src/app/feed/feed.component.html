<div class="message" *ngFor="let message of messages">
  <div class="message-header">
    <div class="message-menu">
      <button class="menu-button" (click)="toggleMenu(message.id)">â‹®</button>
      <div class="menu-options" *ngIf="openMenuId === message.id && message.user_id === currentUserId">
        <button (click)="editMessage(message.id, message.content); $event.stopPropagation()">Edit</button>
        <button (click)="deleteMessage(message.id); $event.stopPropagation()">Delete</button>
      </div>
    </div>
  </div>
  
  <div *ngIf="editingMessageId !== message.id">
    <p>{{ message.content }}</p>
    <small>{{ formatDate(message.created_at) }}</small>
  </div>
  
  <div *ngIf="editingMessageId === message.id">
    <textarea [(ngModel)]="editMessageText" maxlength="500"></textarea>
    <div class="edit-actions">
      <button (click)="saveEdit(message.id)">Save</button>
      <button (click)="cancelEdit()">Cancel</button>
    </div>
  </div>
</div>